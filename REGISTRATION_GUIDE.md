# Руководство по регистрации и входу 5LB

## Для пользователей

### Вход/Регистрация через телефон

1. **Введите номер телефона** в формате +7 (999) 123-45-67
2. **Нажмите "Позвонить мне"** - вам позвонит робот
3. **Ответьте на звонок** и запомните 4-значный код
4. **Введите код** на сайте

### Первый вход (новый пользователь)

После ввода кода вы попадете на страницу **"Завершение регистрации"**:

1. **Фамилия** (обязательно)
2. **Имя** (обязательно)
3. **Отчество** (необязательно)
4. **Дата рождения** (обязательно)
5. **Пол** (необязательно)
6. **Реферальный код** (необязательно) - если вас пригласил друг

После завершения регистрации:
- ✅ Вы получите свой уникальный **реферальный код**
- ✅ Можете приглашать друзей и получать **500 бонусов** за каждого

### Вход через Telegram

1. **Нажмите "Войти через Telegram"**
2. **Подтвердите** в Telegram приложении
3. Готово! Код не требуется

Если это первый вход через Telegram, вас также попросят заполнить данные для регистрации.

## Безопасность

### Почему я не выхожу из аккаунта?

Теперь система использует **безопасные сессии**:
- ✅ Вы остаетесь в аккаунте даже при смене IP адреса
- ✅ Сессия действительна 30 дней
- ✅ Автоматическое обновление при каждом посещении

### Как выйти?

**Выход с текущего устройства:**
- Профиль → Кнопка "Выйти"

**Выход со всех устройств:**
- Профиль → Настройки → "Выйти со всех устройств"

## Реферальная программа

### Как получить бонусы?

1. **Завершите регистрацию** - получите свой реферальный код
2. **Поделитесь кодом** с друзьями
3. **Получайте 500 бонусов** за каждого друга, который зарегистрируется

### Как использовать чужой реферальный код?

При первой регистрации:
1. Введите реферальный код друга в поле "Реферальный код"
2. Завершите регистрацию
3. Ваш друг получит бонусы!

**Важно:** реферальный код можно указать только при первой регистрации.

## Частые вопросы

### Я не получил звонок
- Проверьте правильность номера телефона
- Подождите 60 секунд и нажмите "Позвонить еще раз"
- Попробуйте войти через Telegram

### Код не подходит
- Убедитесь, что вводите последние 4 цифры из звонка
- Код действителен 5 минут
- Запросите новый код

### Забыл заполнить данные при регистрации
- Не беспокойтесь! При следующем входе вас снова попросят заполнить данные
- Пока данные не заполнены, некоторые функции могут быть недоступны

### Потерял доступ к номеру телефона
- Обратитесь в поддержку через Telegram
- Мы поможем восстановить доступ

### Как изменить личные данные?
- Профиль → Настройки → Личные данные

## Для разработчиков

### Тестирование

**Тестовый номер:** не требуется, используйте реальный

**Тестовый Telegram:**
1. Создайте тестового бота через @BotFather
2. Укажите `TELEGRAM_BOT_TOKEN` в `.env`

### Debug

**Проверка cookies:**
```javascript
// В браузере (DevTools Console)
document.cookie
```

**Проверка сессии:**
```bash
curl -X POST http://localhost:3000/api/auth/refresh \
  -H "Cookie: accessToken=...; refreshToken=..." \
  --cookie-jar cookies.txt
```

**Просмотр refresh tokens в БД:**
```sql
SELECT * FROM "RefreshToken" WHERE "userId" = 'user_id';
```

### Миграция данных

Если у вас есть старые пользователи с JWT токенами:

1. **Они продолжат работать** (обратная совместимость в `tokenService.ts`)
2. При следующем входе получат новые cookie-токены
3. Старые JWT токены можно удалить из localStorage

### Переменные окружения

```env
# Backend
JWT_SECRET=your-secret-key
NODE_ENV=production

# Telegram
TELEGRAM_BOT_TOKEN=123456:ABC-DEF...

# SMSC.ru
SMSC_LOGIN=your-login
SMSC_PASSWORD=your-password
```

### Развертывание

```bash
# Обновление БД
cd backend
npx prisma db push

# Деплой
cd ..
./deploy.sh
```

## Поддержка

**Telegram:** @your_support_bot
**Email:** support@5lb.ru
**Документация:** `/COOKIE_AUTH_SYSTEM.md`
