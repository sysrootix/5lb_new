# –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ù–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- `migrate-subcategories-brands.sh` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ psql)
- `migrate-subcategories-brands-node.sh` - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (—á–µ—Ä–µ–∑ Prisma)
- `check-migration-status.sh` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
- `rollback.sql` - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–π SQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /root/5lb
./scripts/migrate-subcategories-brands.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Node.js –∏ Prisma

```bash
cd /root/5lb
./scripts/migrate-subcategories-brands-node.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
./scripts/check-migration-status.sh
```

## üìù –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è

1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `catalog_subcategories` (–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `catalog_brands` (–±—Ä–µ–Ω–¥—ã)
3. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è `subcategoryId` –∏ `brandId` –≤ `catalog_products`
4. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
5. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
6. ‚úÖ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PostgreSQL –∫–ª–∏–µ–Ω—Ç (`psql`)
- –î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `DATABASE_URL`
- –§–∞–π–ª `.env` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `backend/` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `DATABASE_URL`

–ü—Ä–∏–º–µ—Ä `.env`:
```env
DATABASE_URL=postgresql://user:password@localhost:5432/lb_db
```

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–°–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
- **10 –±—Ä–µ–Ω–¥–æ–≤**: NOW Foods, Solgar, Optimum Nutrition, SNT, Universal Nutrition, Dymatize, BSN, GNC, 21st Century, California Gold Nutrition
- **18 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π** –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö:
  - –ü–∏—â–µ–≤—ã–µ –¥–æ–±–∞–≤–∫–∏: –†—ã–±–∏–π –∂–∏—Ä –∏ –û–º–µ–≥–∞, –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è, –¢—Ä–∞–≤—ã, –í–∏—Ç–∞–º–∏–Ω—ã D, –í–∏—Ç–∞–º–∏–Ω—ã –≥—Ä—É–ø–ø—ã B, –í–∏—Ç–∞–º–∏–Ω C, –ö–∞–ª—å—Ü–∏–π –∏ –º–∞–≥–Ω–∏–π, –ñ–µ–ª–µ–∑–æ
  - –°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ: –ü—Ä–æ–±–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã, –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã, –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã, –°—ã–≤–æ—Ä–æ—Ç–æ—á–Ω—ã–π –ø—Ä–æ—Ç–µ–∏–Ω, –ö–∞–∑–µ–∏–Ω–æ–≤—ã–π –ø—Ä–æ—Ç–µ–∏–Ω, –ú–Ω–æ–≥–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø—Ä–æ—Ç–µ–∏–Ω
  - –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã: –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞, –®–µ–π–∫–µ—Ä—ã, –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –í–µ—Å—ã

## üîÑ –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
cd /root/5lb/backend

# –ò–∑–≤–ª–µ–∫–∏—Ç–µ DATABASE_URL
export DATABASE_URL=$(grep DATABASE_URL .env | cut -d '=' -f2- | tr -d '"')

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—Ç–∫–∞—Ç–∞
psql "$DATABASE_URL" -f prisma/migrations/20250101000000_add_subcategories_and_brands/rollback.sql
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –û—Ç–∫–∞—Ç —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü `catalog_subcategories` –∏ `catalog_brands`!

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "permission denied"
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤.

### –û—à–∏–±–∫–∞: "relation already exists"
–¢–∞–±–ª–∏—Ü—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç. –ú–∏–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS`, –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

### –û—à–∏–±–∫–∞: "DATABASE_URL not found"
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `backend/.env` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `DATABASE_URL`.

### –û—à–∏–±–∫–∞: "psql: command not found"
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL –∫–ª–∏–µ–Ω—Ç:
```bash
# Ubuntu/Debian
sudo apt-get install postgresql-client

# CentOS/RHEL
sudo yum install postgresql
```

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ:
`backend/prisma/migrations/20250101000000_add_subcategories_and_brands/MIGRATION_README.md`

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
SELECT COUNT(*) FROM catalog_subcategories;
SELECT COUNT(*) FROM catalog_brands;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–µ–π –≤ catalog_products
SELECT COUNT(*) FROM catalog_products WHERE "subcategoryId" IS NOT NULL;
SELECT COUNT(*) FROM catalog_products WHERE "brandId" IS NOT NULL;
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
./scripts/check-migration-status.sh
```

