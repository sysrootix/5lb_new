#!/usr/bin/env bash
# deploy-all.sh
# Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Ğ´Ğ»Ñ 5LB Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
#   ./deploy-all.sh              - Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸ CRM
#   ./deploy-all.sh app          - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
#   ./deploy-all.sh crm          - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ CRM
#   ./deploy-all.sh --help       - ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ°

set -Eeuo pipefail

### === ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ===
PROJECT_DIR="${PROJECT_DIR:-$PWD}"

# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
APP_FRONTEND_DIR="$PROJECT_DIR/frontend"
APP_BACKEND_DIR="$PROJECT_DIR/backend"
APP_DIST_SRC="$APP_FRONTEND_DIR/dist/"
APP_DIST_DST="/var/www/5lb/dist/"
APP_PM2_NAME="5lb-backend"

# CRM
CRM_DIR="$PROJECT_DIR/crm"
CRM_FRONTEND_DIR="$CRM_DIR/crm_frontend"
CRM_BACKEND_DIR="$CRM_DIR/crm_backend"
CRM_DIST_SRC="$CRM_FRONTEND_DIR/dist/"
CRM_DIST_DST="/var/www/5lb-crm/"
CRM_PM2_NAME="5lb-crm-backend"

RSYNC_FLAGS="${RSYNC_FLAGS:--av --delete --exclude=.image-backups}"
SUDO="${SUDO:-sudo}"

### === Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ ===
info(){ echo -e "\033[1;34m[INFO]\033[0m $*"; }
ok(){   echo -e "\033[1;32m[DONE]\033[0m $*"; }
err(){  echo -e "\033[1;31m[ERROR]\033[0m $*" >&2; }
warn(){ echo -e "\033[1;33m[WARN]\033[0m $*"; }

trap 'err "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ° ÑˆĞ°Ğ³Ğµ: ${BASH_COMMAND}"' ERR

show_help() {
    cat << EOF
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           ğŸš€ 5LB Unified Deployment Script                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
  $0 [Ğ¾Ğ¿Ñ†Ğ¸Ñ]

ĞĞ¿Ñ†Ğ¸Ğ¸:
  (Ğ±ĞµĞ· Ğ¾Ğ¿Ñ†Ğ¸Ğ¹)    Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ˜ CRM
  app            Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ (5LB)
  crm            Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ CRM
  --help, -h     ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ñƒ ÑĞ¿Ñ€Ğ°Ğ²ĞºÑƒ

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
  $0             # ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹
  $0 app         # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
  $0 crm         # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ CRM

Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ ÑĞºÑ€Ğ¸Ğ¿Ñ‚:
  âœ“ ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
  âœ“ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ (Vite)
  âœ“ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ±ÑĞºĞµĞ½Ğ´ (TypeScript)
  âœ“ Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Prisma Client
  âœ“ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ (rsync)
  âœ“ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ PM2 Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹

EOF
    exit 0
}

### === ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ===
check_dependencies() {
    for cmd in npm rsync pm2; do
        command -v "$cmd" >/dev/null 2>&1 || { err "$cmd Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"; exit 1; }
    done
}

### === Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ ===
deploy_app() {
    info "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    info "ğŸ“¦ Ğ”Ğ•ĞŸĞ›ĞĞ™ ĞĞ¡ĞĞĞ’ĞĞĞ“Ğ ĞŸĞ Ğ˜Ğ›ĞĞ–Ğ•ĞĞ˜Ğ¯ (5LB)"
    info "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹
    [[ -d "$APP_FRONTEND_DIR" ]] || { err "ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ° Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ°: $APP_FRONTEND_DIR"; exit 1; }
    [[ -d "$APP_BACKEND_DIR" ]] || { err "ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ° Ğ±ÑĞºĞ°: $APP_BACKEND_DIR"; exit 1; }

    # ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
    info "ğŸ–¼ï¸  ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ..."
    cd "$PROJECT_DIR"
    npm run optimize-images || warn "âš ï¸  ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ°ÑÑŒ, Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹..."
    ok "Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹"

    # Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°
    info "ğŸ”¨ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ñ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ (npm run build:frontend)"
    cd "$PROJECT_DIR"
    npm run build:frontend
    [[ -d "$APP_DIST_SRC" ]] || { err "ĞŸĞ¾ÑĞ»Ğµ ÑĞ±Ğ¾Ñ€ĞºĞ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ dist: $APP_DIST_SRC"; exit 1; }
    ok "Ğ¤Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ ÑĞ¾Ğ±Ñ€Ğ°Ğ½"

    # Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ±ÑĞºĞµĞ½Ğ´Ğ°
    info "ğŸ”¨ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ñ Ğ±ÑĞºĞµĞ½Ğ´ (npm run build:backend)"
    cd "$PROJECT_DIR"
    npm run build:backend
    ok "Ğ‘ÑĞºĞµĞ½Ğ´ ÑĞ¾Ğ±Ñ€Ğ°Ğ½"

    # Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ°
    info "ğŸ“¤ Ğ’Ñ‹ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°Ñ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´: $APP_DIST_SRC -> $APP_DIST_DST"
    $SUDO rsync $RSYNC_FLAGS "$APP_DIST_SRC" "$APP_DIST_DST"
    ok "Ğ¤Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ Ğ²Ñ‹Ğ»Ğ¾Ğ¶ĞµĞ½"

    # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº PM2
    info "ğŸ”„ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ PM2: $APP_PM2_NAME"
    pm2 reload "$APP_PM2_NAME"
    ok "PM2 Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½"

    ok "âœ… Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½!"
}

### === Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ CRM ===
deploy_crm() {
    info "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    info "ğŸ“¦ Ğ”Ğ•ĞŸĞ›ĞĞ™ CRM"
    info "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹
    [[ -d "$CRM_FRONTEND_DIR" ]] || { err "ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ° CRM Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ°: $CRM_FRONTEND_DIR"; exit 1; }
    [[ -d "$CRM_BACKEND_DIR" ]] || { err "ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ° CRM Ğ±ÑĞºĞ°: $CRM_BACKEND_DIR"; exit 1; }

    # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°
    info "ğŸ“¦ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°..."
    cd "$CRM_FRONTEND_DIR"
    npm install --silent || npm install
    ok "Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"

    # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ±ÑĞºĞµĞ½Ğ´Ğ°
    info "ğŸ“¦ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´Ğ°..."
    cd "$CRM_BACKEND_DIR"
    npm install --silent || npm install
    ok "Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"

    # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Prisma Client
    info "ğŸ”§ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Prisma Client..."
    cd "$CRM_BACKEND_DIR"
    npx prisma generate
    ok "Prisma Client ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"

    # Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°
    info "ğŸ”¨ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ñ CRM Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´..."
    cd "$CRM_FRONTEND_DIR"
    npm run build
    [[ -d "$CRM_DIST_SRC" ]] || { err "ĞŸĞ¾ÑĞ»Ğµ ÑĞ±Ğ¾Ñ€ĞºĞ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ dist: $CRM_DIST_SRC"; exit 1; }
    ok "CRM Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ ÑĞ¾Ğ±Ñ€Ğ°Ğ½"

    # Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ±ÑĞºĞµĞ½Ğ´Ğ°
    info "ğŸ”¨ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ñ CRM Ğ±ÑĞºĞµĞ½Ğ´..."
    cd "$CRM_BACKEND_DIR"
    npx tsc
    ok "CRM Ğ±ÑĞºĞµĞ½Ğ´ ÑĞ¾Ğ±Ñ€Ğ°Ğ½"

    # Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ°
    if [ ! -d "$CRM_DIST_DST" ]; then
        warn "ĞŸĞ°Ğ¿ĞºĞ° $CRM_DIST_DST Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, ÑĞ¾Ğ·Ğ´Ğ°Ñ..."
        $SUDO mkdir -p "$CRM_DIST_DST"
    fi

    info "ğŸ“¤ Ğ’Ñ‹ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°Ñ CRM Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´: $CRM_DIST_SRC -> $CRM_DIST_DST"
    $SUDO rsync $RSYNC_FLAGS "$CRM_DIST_SRC" "$CRM_DIST_DST"
    ok "CRM Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ Ğ²Ñ‹Ğ»Ğ¾Ğ¶ĞµĞ½"

    # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº PM2
    info "ğŸ”„ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ PM2: $CRM_PM2_NAME"
    if pm2 list | grep -q "$CRM_PM2_NAME"; then
        pm2 reload "$CRM_PM2_NAME"
    else
        warn "ĞŸÑ€Ğ¾Ñ†ĞµÑÑ $CRM_PM2_NAME Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² PM2, Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¹..."
        cd "$CRM_BACKEND_DIR"
        if [ -f "dist/src/index.js" ]; then
            pm2 start dist/src/index.js --name "$CRM_PM2_NAME"
        elif [ -f "dist/index.js" ]; then
            pm2 start dist/index.js --name "$CRM_PM2_NAME"
        else
            pm2 start src/index.ts --name "$CRM_PM2_NAME" --interpreter ./node_modules/.bin/ts-node
        fi
    fi
    ok "PM2 Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½"

    ok "âœ… Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ CRM Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½!"
}

### === ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ===
main() {
    local mode="${1:-all}"

    case "$mode" in
        --help|-h)
            show_help
            ;;
        app)
            check_dependencies
            deploy_app
            ;;
        crm)
            check_dependencies
            deploy_crm
            ;;
        all|"")
            check_dependencies
            deploy_app
            echo ""
            deploy_crm
            ;;
        *)
            err "ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾Ğ¿Ñ†Ğ¸Ñ: $mode"
            echo "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --help Ğ´Ğ»Ñ ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ¸"
            exit 1
            ;;
    esac

    echo ""
    ok "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    ok "â•‘          ğŸ‰ Ğ’Ğ¡Ğ• Ğ”Ğ•ĞŸĞ›ĞĞ˜ Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ«! ğŸ‰              â•‘"
    ok "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

main "$@"
